
### 1. 经验分布函数（ECDF）

**通俗理解**：

就是用手头的数据样本来估计真实的概率分布。比如你想知道某地成年人身高的分布规律，但不可能测量所有人，只能抽样调查100个人，然后用这100个人的数据来推测总体分布。

**解决问题**：

- 不知道真实分布时，**用样本数据近似估计**
- 为统计推断提供基础（如假设检验、置信区间）

**数学定义**：

给定样本 $X_1,...,X_n$，经验分布函数：：$F_n(x) = \frac{1}{n}\Sigma_{i=1}^n 1_{(X_i \leq x)}$

**举例**：

- 假设我测量了2个学生的身高，$X_1 = 165, X_2 = 176$
- 经验分布函数就是：$F_2(x) = \frac{1}{2}(I_{(165 \leq x)} + I_{(176 \leq x)})$
- $F_2(160) = \frac{1}{2}(0 + 0) = 0$ - 没有人身高小于 160
- $F_2(170) = \frac{1}{2}(1 + 0) = \frac{1}{2}$ - 身高小于 170 的人概率是 50%
- $F_2(180) = \frac{1}{2}(1 + 1) = 1$ - 身高小于 180 的人概率是100%

**实验**：

```r
set.seed(123)
# 模拟10个数据点
X <- rnorm(10, mean=170, sd=10)
X <- sort(X) # 排序方便查看
X # 查看X
X <- round(X,2) # 保留2位小数

# 根据采样数据X产生经验分布函数 F_10
ecdf_F_10 <- ecdf(X)

# 估计一些值
ecdf_F_10(160)
ecdf_F_10(170)
ecdf_F_10(180)

# 画出经验分布函数图像，是个阶跃函数图像
plot(ecdf_F_10, main = "经验分布函数图像", xlab = "x", ylab = "F10(x)", col = "blue", lwd = 2, cex.main = 1.2)
grid(col = "gray", lty = "dotted") # 添加网格线
points(X, ecdf_F_10(X), pch = 19, col = "red", cex = 1.2) # 标记样本点

# 添加真实分布函数作为对比（虚线） 
curve(pnorm(x, mean = 170, sd = 10), add = TRUE, col = "darkgreen", lwd = 2, lty = 2)
```

![[ECDF.png]]

可以看到，**样本量只有10个时**，经验分布函数是个明显的阶梯函数，与真实分布还有差距，增加样本量：

```r
# 对比不同样本量的效果
par(mfrow = c(2, 2), mar = c(4, 4, 3, 1))

sample_sizes <- c(10, 50, 200, 1000)

for(n in sample_sizes) {
  set.seed(123)
  X_n <- rnorm(n, mean = 170, sd = 10)
  ecdf_n <- ecdf(X_n)
  
  plot(ecdf_n, 
       main = paste("n =", n), 
       xlab = "x", 
       ylab = "Fn(x)",
       col = "blue",
       lwd = 2)
  
  # 添加真实分布
  curve(pnorm(x, mean = 170, sd = 10), 
        add = TRUE, 
        col = "darkgreen", 
        lwd = 2, 
        lty = 2)
  
  grid(col = "gray", lty = "dotted")
}

legend("bottomright", 
       legend = c("经验分布", "真实分布"),
       col = c("blue", "darkgreen"),
       lty = c(1, 2),
       lwd = 2,
       cex = 0.8)
```

![[GlivenkoCantelliTheorem.png]]

这验证了 **格里汶科定理**：样本量越大，**经验分布函数越接近真实分布函数**，数学定义如下：

- **Glivenko-Cantelli Theorem**

			$lim_{n \to \infty}F_n(x) = F(x), \forall x \in \mathbb{R}$

- **数学证明**：
	- **对于采样的样本**：$X_1,...,X_n$
	- **引入指示变量**：
		- $Z_i = 1_{(y_i < y)}$ 
		- 目的是把 “**计数**” 变成 “**求和**”
	- **等号左边**：
		- **经验分布函数定义**：$F_n(x) = \frac{1}{n}\Sigma_{i=1}^n 1_{(X_i \leq x)}$
		- **用指示变量改写**：$F_n(x) = \frac{1}{n} \sum_{i=1}^n Z_i = \bar{Z}_n$
		- **即** $F_n(x)$ 是指示变量 $Z_1,...,Z_n$ 的**算术平均值**
	- **等号右边**：
		- $E(Z_i) = 1 \cdot P(Z_i = 1) + 0 \cdot P(Z_i=0) = P(Z_i = 1)$
		- 由于 $Z_i = 1_{(X_i \leq x)}$，所以 $P(Z_i = 1) = P(X_i \leq x)$
		- **根据分布函数定义**，$P(X_i \leq x) = F(x)$
		- 所以，$E(Z_i) = F(x)$
	- **应用大数定律**：
		- 对于独立同分布的指示变量 $Z_1, Z_2, ..., Z_n$，如果 $E[Z_i]$ 存在，**则样本均值依概率收敛到总体均值**
		- 所以，$\lim_{n \to \infty} \bar{Z}_n \xrightarrow{P} E(Z_i)$
		- 结合 $F_n(x) = \bar{Z}_n$ 和 $E(Z_i) = F(x)$
		- 所以，$\lim_{n \to \infty}F_n(x) \xrightarrow{P} F(x), \quad \forall x \in \mathbb{R}$

### 大数定理

设 $y_1, ..., y_n$ 为来自分布函数为 $F(.)$ 的分布的随机样本，那么 $F_n(y)$ 是样本 $y_1, ..., y_n$ 的 **经验分布函数**，我们在此强调的最后一个渐近性陈述是大数定律，它表明，**随机变量的算术平均值收敛于真实均值**：

- **R语言实验**：

```r
# 验证指示变量的大数定律
set.seed(123)

# 真实情况：假设身高服从 N(170, 10)
# 我们关心：P(身高 ≤ 165) 是多少？

# 真实概率（理论值）
true_prob <- pnorm(165, mean = 170, sd = 10) # pnorm 就是 F(165) = P(x <= 165)
cat("真实概率 E[Zi] =", round(true_prob, 3), "\n\n")

# 模拟采样
n <- 5000  # 采样5000人
heights <- rnorm(n, mean = 170, sd = 10)  # 原始样本 Xi

# 计算累积平均值, 是模拟1-5000人采样时候的平均值，方便看曲线收敛
# 可以尝试cumsum函数使用
cumulative_mean <- cumsum(heights <= 165) / (1:5000)

# 把模拟的平均值
plot(1:n, cumulative_mean, 
     type = "l", 
     col = "blue", 
     lwd = 2,
     xlab = "样本量 n", 
     ylab = "样本均值 Z̄ₙ",
     main = "大数定律：样本均值收敛到总体均值",
     ylim = c(0, 1))

# 添加真实概率的水平线
abline(h = true_prob, col = "red", lwd = 2, lty = 2)

# 图例
legend("topright", 
       legend = c("样本均值 Z̄ₙ", "总体均值 E[Zi]"),
       col = c("blue", "red"),
       lty = c(1, 2),
       lwd = 2)

grid()
```

![[lawoflargenumbers.png]]

- **数学定义**：设 $Y_1, ..., Y_n$ 为从某个均值为 $\mu$ 的分布函数中 **独立同分布** 抽取的随机样本，那么,对于 **任何小但为正的值** $\delta$，我们得到：

				$lim_{n \to \infty}P(|\bar{Y} - \mu| > \delta) = 0$


```r
# 一次性取样个数
max_sample_num <- 1000 
# 采样
samples <- rnorm(max_sample_num, mean = 8)
# 从1到max_sample_num计算max_sample_num个均值，用于观察均值收敛
cummean <- cumsum(samples)/(1:max_sample_num)
# 均值减去理论均值
cumdelta <- cummean - 8
# 绘图
plot(1:max_sample_num, cumdelta, 
     type = "l",           # 折线图        
     lwd = 2,
     xlab = "样本量 n",
     ylab = "|样本均值 - 8|",
     main = "样本均值收敛到总体均值")
# 画一个理论均值的直线
abline(h = 0, col = "red", lty = 2)
# 画网格
grid()
```